---
title: "Preparing the rcqp.mac package"
output: html_document
---

Requirements: Preparing this package requires a system that has the compiled
libraries (libintl, libglib etc.) present!

To be executed in the directory where the rcqp.mac package is to 
be created.

```{sh}
wget https://cran.r-project.org/src/contrib/rcqp_0.4.tar.gz
tar xzfv rcqp_0.4.tar.gz
rm rcqp_0.4.tar.gz
mv rcqp/* .
rm -r rcqp
rm -r src
mkdir inst/libs
```

The dependant libraries are copied into the libs directory. To identify 
where the libraries reside, 'locate' has been used 

```{sh}
cp /usr/local/lib/libglib-2.0.0.dylib inst/libs
cp /usr/lib/libiconv.2.dylib inst/libs
cp /usr/local/Cellar/gettext/0.19.8.1/lib/libintl.8.dylib inst/libs
sudo cp /usr/local/lib/libpcre.1.dylib inst/libs
cp /Library/Frameworks/R.framework/Versions/3.4/Resources/library/rcqp/libs/rcqp.so inst/libs
chmod 0755 inst/libs/*

rm configure*
rm cleanup
rm MD5
```

Go into the R directory, edit the file zzz.R and ensure that the .onLoad
function is defined as follows:

```{r}
.onLoad <-function (lib, pkg) {
  library.dynam("libiconv.2", package = pkg, lib.loc = lib, file.ext = ".dylib")
  library.dynam("libintl.8", package = pkg, lib.loc = lib, file.ext = ".dylib")
  library.dynam("libglib-2.0.0", package = pkg, lib.loc = lib, file.ext = ".dylib")
  library.dynam("libpcre.1", package = pkg, lib.loc = lib, file.ext = ".dylib")
  library.dynam("rcqp", package = pkg, lib.loc = lib, file.ext = ".so")
}
```

Check whether the package can be built and installed.

```{sh}
cd ..
R CMD build rcqp.mac
R CMD INSTALL rcqp_0.4.tar.gz
```

Building and checking the polmineR package may provide a check that the 
new package works.

```{r}
R CMD INSTALL --build rcqp.mac
scp rcqp_0.4.tgz blaette@polmine.sowi.uni-due.de:/home/blaette
ssh blaette@polmine.sowi.uni-due.de
```

```{sh}
cd /var/www/packages/bin/macosx/contrib/3.4
sudo mv /home/blaette/rcqp_0.4.tgz .
sudo Rscript -e 'tools::write_PACKAGES()'
```

```{r}
```
